// Equine Acres Database Schema
// PostgreSQL via Neon (serverless)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Main player/farm data
model Player {
  id       String   @id @default(cuid())
  farmName String

  // Core stats
  day       Int @default(1)
  money     Int @default(1000)
  energy    Int @default(100)
  maxEnergy Int @default(100)

  // Livestock counts
  chickens    Int     @default(0)
  isFreeRange Boolean @default(false)
  dairyCows   Int     @default(0)
  beefCows    Int     @default(0)
  beefPrice   Int     @default(200)
  goats       Int     @default(0)
  pigs        Int     @default(0)
  pigPrice    Int     @default(120)

  // Daily chore flags
  hasCollectedEggs   Boolean @default(false)
  hasMilkedCows      Boolean @default(false)
  hasMilkedGoats     Boolean @default(false)
  hasCollectedManure Boolean @default(false)

  // Inventory
  eggs   Int @default(0)
  milk   Int @default(0)
  feed   Int @default(30)
  manure Int @default(0)

  // Infrastructure
  cleanliness    Int @default(100)
  infrastructure Int @default(100)

  // Crops (single field for now)
  cropGrowth Int      @default(0)
  activeCrop String?
  fieldWater Int      @default(50)
  fieldPests Boolean  @default(false)

  // Game state
  weather   String @default("Sunny")
  gameStage String @default("SETUP")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  horses       Horse[]
  logs         GameLog[]
  achievements Achievement[]
  equipment    Equipment[]

  @@map("players")
}

// Individual horses (premium livestock)
model Horse {
  id         String @id @default(cuid())
  playerId   String
  name       String
  isNamed    Boolean @default(false)
  breed      String
  age        Int     @default(6) // in months
  health     Int     @default(100)
  hunger     Int     @default(0)
  happiness  Int     @default(100)
  experience Int     @default(0)
  level      Int     @default(1)
  stamina    Int     @default(100)
  bio        String  @default("")
  value      Int     @default(500)

  createdAt DateTime @default(now())

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("horses")
}

// Game activity logs
model GameLog {
  id        String   @id @default(cuid())
  playerId  String
  day       Int
  message   String
  type      String   // 'info' | 'success' | 'warning' | 'danger' | 'flavor'
  createdAt DateTime @default(now())

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId, day])
  @@map("game_logs")
}

// Unlocked achievements
model Achievement {
  id            String   @id @default(cuid())
  playerId      String
  achievementId String   // References achievement from config
  unlockedAt    DateTime @default(now())

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([playerId, achievementId])
  @@map("achievements")
}

// Player equipment
model Equipment {
  id          String @id @default(cuid())
  playerId    String
  equipmentId String // References equipment from config

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([playerId, equipmentId])
  @@map("equipment")
}
